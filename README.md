# rust-async-profile
Rust asynchronous profiling tool
# prerequisite:
* Please install and build [uftrace](https://github.com/namhyung/uftrace) first
* Make sure the rust toolchain supports `mcount` call (the `mcount` flag is temporarily broken and see [here](https://github.com/namhyung/uftrace/issues/1392) for a workaround)  
and if the circumstances permit, you can just use the earlier toolchain (`nightly-2021-03-16-x86_64-unknown-linux-gnu`)
* Build your executable in debug mode  
e.g.
```
RUSTFLAGS="-Z instrument-mcount" cargo build 
```
# Usage
* Clone the repository (No building needed) 
* Move the profile directory into your `target` directory
 ```
 profile
 ├── parser.py
 └── profile.sh
 ```
* Run the profiler script:  
`. profile.sh $EXECUTABLE_NAME $OUTPUT_FILE_NAME`
* After executing the script, we get a json file in the profile directory  
 ```
 profile
 ├── parser.py
 └── profile.sh
 └── $OUTPUT_FILE_NAME.json
 ```  
 * Then we can use the trace-viewer to visualize the result:
   * Open the chrome browser
   * Type `chrome://tracing/` on your chrome browser
   * Load the json file generated by profiler
 * Result example:  
 ![image](https://user-images.githubusercontent.com/37073963/155326380-1cf10cfd-6535-4a2d-b524-ccc553d03565.png)
